<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotto PRNG Analyzer</title>
    <style>
        :root {
            --primary: #4a148c;
            --secondary: #7b1fa2;
            --dark: #12005e;
            --light: #f3e5f5;
            --accent: #e1bee7;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: var(--light);
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 2rem 0;
            text-align: center;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        h1 {
            margin: 0;
            font-size: 2.5rem;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .card h2 {
            color: var(--secondary);
            margin-top: 0;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 0.5rem;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 1rem;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            background: #eee;
            border: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            margin-bottom: 5px;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: var(--primary);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        button:hover {
            background-color: var(--secondary);
        }
        
        button.secondary {
            background-color: #757575;
        }
        
        button.success {
            background-color: var(--success);
        }
        
        button.warning {
            background-color: var(--warning);
        }
        
        button.danger {
            background-color: var(--danger);
        }
        
        .result {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid var(--accent);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .lotto-balls {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .ball {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .ball.powerball {
            background-color: var(--danger);
        }
        
        .progress-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin: 1rem 0;
        }
        
        .progress-bar {
            height: 20px;
            background-color: var(--primary);
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s;
        }
        
        .status {
            margin: 1rem 0;
            padding: 0.5rem;
            border-radius: 4px;
        }
        
        .status.info {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
        }
        
        .status.success {
            background-color: #e8f5e9;
            border-left: 4px solid var(--success);
        }
        
        .status.warning {
            background-color: #fff8e1;
            border-left: 4px solid var(--warning);
        }
        
        .status.error {
            background-color: #ffebee;
            border-left: 4px solid var(--danger);
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Lotto PRNG Analyzer</h1>
            <p class="subtitle">Analyze and reverse-engineer lottery number generators</p>
        </div>
    </header>
    
    <div class="container">
        <div class="card">
            <h2>Lotto Number Generator</h2>
            
            <div class="tabs">
                <button class="tab active" onclick="openTab(event, 'generate')">Generate Numbers</button>
                <button class="tab" onclick="openTab(event, 'reverse')">Reverse Engineer</button>
                <button class="tab" onclick="openTab(event, 'compare')">Compare Draws</button>
            </div>
            
            <div id="generate" class="tab-content active">
                <div class="grid">
                    <div>
                        <label for="game-type">Lottery Game:</label>
                        <select id="game-type">
                            <option value="powerball">Powerball (5/69 + 1/26)</option>
                            <option value="megamillions">Mega Millions (5/70 + 1/25)</option>
                            <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                            <option value="custom">Custom Game</option>
                        </select>
                        
                        <div id="custom-params" style="display: none;">
                            <div class="grid">
                                <div>
                                    <label for="main-numbers">Main Numbers Pool:</label>
                                    <input type="number" id="main-numbers" min="1" value="69">
                                </div>
                                <div>
                                    <label for="pick-numbers">Numbers to Pick:</label>
                                    <input type="number" id="pick-numbers" min="1" value="5">
                                </div>
                            </div>
                            <div class="grid">
                                <div>
                                    <label for="bonus-numbers">Bonus Numbers Pool:</label>
                                    <input type="number" id="bonus-numbers" min="0" value="26">
                                </div>
                                <div>
                                    <label for="pick-bonus">Bonus Numbers to Pick:</label>
                                    <input type="number" id="pick-bonus" min="0" value="1">
                                </div>
                            </div>
                        </div>
                        
                        <label for="seed">Seed (leave empty for random):</label>
                        <input type="number" id="seed">
                        
                        <label for="draw-count">Number of draws:</label>
                        <input type="number" id="draw-count" min="1" value="1" max="100">
                        
                        <button onclick="generateLottoNumbers()" class="success">Generate</button>
                        <button onclick="clearGeneration()" class="secondary">Clear</button>
                    </div>
                    
                    <div>
                        <label>Generated Numbers:</label>
                        <div id="generated-results"></div>
                        
                        <div class="result">
                            <strong>Generation Details:</strong>
                            <div id="gen-details"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="reverse" class="tab-content">
                <div class="grid">
                    <div>
                        <label for="reverse-game-type">Lottery Game:</label>
                        <select id="reverse-game-type">
                            <option value="powerball">Powerball (5/69 + 1/26)</option>
                            <option value="megamillions">Mega Millions (5/70 + 1/25)</option>
                            <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                            <option value="custom-reverse">Custom Game</option>
                        </select>
                        
                        <div id="custom-reverse-params" style="display: none;">
                            <div class="grid">
                                <div>
                                    <label for="reverse-main-numbers">Main Numbers Pool:</label>
                                    <input type="number" id="reverse-main-numbers" min="1" value="69">
                                </div>
                                <div>
                                    <label for="reverse-pick-numbers">Numbers to Pick:</label>
                                    <input type="number" id="reverse-pick-numbers" min="1" value="5">
                                </div>
                            </div>
                            <div class="grid">
                                <div>
                                    <label for="reverse-bonus-numbers">Bonus Numbers Pool:</label>
                                    <input type="number" id="reverse-bonus-numbers" min="0" value="26">
                                </div>
                                <div>
                                    <label for="reverse-pick-bonus">Bonus Numbers to Pick:</label>
                                    <input type="number" id="reverse-pick-bonus" min="0" value="1">
                                </div>
                            </div>
                        </div>
                        
                        <label for="observed-numbers">Observed Numbers (one draw per line, format: 1,2,3,4,5|1):</label>
                        <textarea id="observed-numbers" rows="5" placeholder="Example for Powerball:
3, 17, 25, 36, 55 | 12
5, 10, 20, 30, 40 | 5"></textarea>
                        
                        <div class="status info" id="reverse-status">
                            Enter observed numbers to begin reverse engineering.
                        </div>
                        
                        <div class="progress-container" id="reverse-progress" style="display: none;">
                            <div class="progress-bar" id="progress-bar"></div>
                        </div>
                        
                        <button onclick="reverseEngineerSeed()" class="warning">Reverse Engineer Seed</button>
                        <button onclick="stopReverseEngineer()" class="danger" id="stop-button" style="display: none;">Stop</button>
                        <button onclick="clearReverse()" class="secondary">Clear</button>
                    </div>
                    
                    <div>
                        <label>Reverse Engineering Results:</label>
                        <div class="result" id="reverse-results">
                            Results will appear here after analysis.
                        </div>
                        
                        <label>Verification:</label>
                        <div id="verification-results"></div>
                    </div>
                </div>
            </div>
            
            <div id="compare" class="tab-content">
                <div class="grid">
                    <div>
                        <label for="compare-seed">Seed to compare:</label>
                        <input type="number" id="compare-seed">
                        
                        <label for="compare-draws">Number of draws to generate:</label>
                        <input type="number" id="compare-draws" min="1" value="10">
                        
                        <label for="compare-observed">Observed Numbers (one draw per line):</label>
                        <textarea id="compare-observed" rows="5"></textarea>
                        
                        <button onclick="compareDraws()" class="success">Compare</button>
                    </div>
                    
                    <div>
                        <label>Comparison Results:</label>
                        <div class="result" id="compare-results">
                            Results will appear here after comparison.
                        </div>
                        
                        <label>Match Statistics:</label>
                        <div class="result" id="compare-stats">
                            Statistics will appear here after comparison.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>How It Works</h2>
            <div class="grid">
                <div>
                    <h3>Lotto PRNG Generation</h3>
                    <p>This tool uses a deterministic pseudo-random number generator (PRNG) to create lottery numbers based on a seed value.</p>
                    <p>The algorithm:</p>
                    <ol>
                        <li>Takes a seed number (or uses current timestamp if none provided)</li>
                        <li>Generates main numbers using a Fisher-Yates shuffle</li>
                        <li>Generates bonus numbers using a separate PRNG sequence</li>
                        <li>Produces the same sequence for the same seed</li>
                    </ol>
                </div>
                
                <div>
                    <h3>Seed Reverse Engineering</h3>
                    <p>When you provide observed numbers, the tool:</p>
                    <ol>
                        <li>Attempts to find a seed that produces matching numbers</li>
                        <li>Uses brute-force search within a specified range</li>
                        <li>Verifies candidate seeds by generating subsequent draws</li>
                        <li>Reports matching seeds and their predicted future draws</li>
                    </ol>
                    <p class="status warning">Note: Reverse engineering may take time depending on the range needed.</p>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>Lotto PRNG Analyzer &copy; 2023 | For educational and research purposes only</p>
            <p>This tool does not predict actual lottery results and should not be used for gambling.</p>
        </div>
    </footer>
    
    <script>
        // Global variables
        let reverseWorker = null;
        let stopReverseFlag = false;
        
        // Tab functionality
        function openTab(evt, tabName) {
            const tabContents = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove("active");
            }
            
            const tabs = document.getElementsByClassName("tab");
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove("active");
            }
            
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }
        
        // Game type change handlers
        document.getElementById('game-type').addEventListener('change', function() {
            document.getElementById('custom-params').style.display = 
                this.value === 'custom' ? 'block' : 'none';
        });
        
        document.getElementById('reverse-game-type').addEventListener('change', function() {
            document.getElementById('custom-reverse-params').style.display = 
                this.value === 'custom-reverse' ? 'block' : 'none';
        });
        
        // Lotto number generator
        function generateLottoNumbers() {
            const gameType = document.getElementById('game-type').value;
            let mainPool, pickCount, bonusPool, bonusCount;
            
            if (gameType === 'custom') {
                mainPool = parseInt(document.getElementById('main-numbers').value) || 69;
                pickCount = parseInt(document.getElementById('pick-numbers').value) || 5;
                bonusPool = parseInt(document.getElementById('bonus-numbers').value) || 0;
                bonusCount = parseInt(document.getElementById('pick-bonus').value) || 0;
            } else {
                // Set parameters based on game type
                switch (gameType) {
                    case 'powerball':
                        mainPool = 69;
                        pickCount = 5;
                        bonusPool = 26;
                        bonusCount = 1;
                        break;
                    case 'megamillions':
                        mainPool = 70;
                        pickCount = 5;
                        bonusPool = 25;
                        bonusCount = 1;
                        break;
                    case 'euromillions':
                        mainPool = 50;
                        pickCount = 5;
                        bonusPool = 12;
                        bonusCount = 2;
                        break;
                    default:
                        mainPool = 69;
                        pickCount = 5;
                        bonusPool = 26;
                        bonusCount = 1;
                }
            }
            
            const seedInput = document.getElementById('seed').value.trim();
            const seed = seedInput ? parseInt(seedInput) : Math.floor(Math.random() * 1000000000);
            const drawCount = parseInt(document.getElementById('draw-count').value) || 1;
            
            // Generate numbers
            let results = '';
            let allNumbers = [];
            
            for (let i = 0; i < drawCount; i++) {
                const currentSeed = seed + i; // Different seed for each draw
                const draw = generateDraw(currentSeed, mainPool, pickCount, bonusPool, bonusCount);
                allNumbers.push(draw);
                
                // Format the numbers
                const mainNumbers = draw.mainNumbers.sort((a, b) => a - b);
                const bonusNumbers = draw.bonusNumbers.sort((a, b) => a - b);
                
                results += `<div class="lotto-draw">
                    <div class="lotto-balls">`;
                
                mainNumbers.forEach(num => {
                    results += `<div class="ball">${num}</div>`;
                });
                
                if (bonusNumbers.length > 0) {
                    results += `<div class="ball powerball">${bonusNumbers.join(', ')}</div>`;
                }
                
                results += `</div>
                    <div><small>Draw ${i+1} | Seed: ${currentSeed}</small></div>
                </div>`;
            }
            
            document.getElementById('generated-results').innerHTML = results;
            
            // Show generation details
            const details = `
                <p>Game: ${gameType}</p>
                <p>Main numbers: ${pickCount} from ${mainPool}</p>
                ${bonusPool > 0 ? `<p>Bonus numbers: ${bonusCount} from ${bonusPool}</p>` : ''}
                <p>Initial seed: ${seed}</p>
                <p>Total draws generated: ${drawCount}</p>
            `;
            
            document.getElementById('gen-details').innerHTML = details;
        }
        
        function generateDraw(seed, mainPool, pickCount, bonusPool, bonusCount) {
            // Create a seeded PRNG using Mulberry32 algorithm
            const prng = new SeededPRNG(seed);
            
            // Generate main numbers using Fisher-Yates shuffle
            const mainNumbers = [];
            const pool = Array.from({length: mainPool}, (_, i) => i + 1);
            
            for (let i = pool.length - 1; i >= pool.length - pickCount; i--) {
                const j = Math.floor(prng.next() * (i + 1));
                [pool[i], pool[j]] = [pool[j], pool[i]];
                mainNumbers.push(pool[i]);
            }
            
            // Generate bonus numbers
            const bonusNumbers = [];
            if (bonusPool > 0 && bonusCount > 0) {
                const bonusPrng = new SeededPRNG(seed + 12345); // Different sequence for bonus
                const bonusPoolArr = Array.from({length: bonusPool}, (_, i) => i + 1);
                
                for (let i = bonusPoolArr.length - 1; i >= bonusPoolArr.length - bonusCount; i--) {
                    const j = Math.floor(bonusPrng.next() * (i + 1));
                    [bonusPoolArr[i], bonusPoolArr[j]] = [bonusPoolArr[j], bonusPoolArr[i]];
                    bonusNumbers.push(bonusPoolArr[i]);
                }
            }
            
            return {
                mainNumbers: mainNumbers,
                bonusNumbers: bonusNumbers,
                seed: seed
            };
        }
        
        // Seeded PRNG implementation (Mulberry32)
        class SeededPRNG {
            constructor(seed) {
                this.seed = seed;
            }
            
            next() {
                this.seed |= 0;
                this.seed = this.seed + 0x6D2B79F5 | 0;
                let t = Math.imul(this.seed ^ this.seed >>> 15, 1 | this.seed);
                t = t + Math.imul(t ^ t >>> 7, 61 | t) ^ t;
                return ((t ^ t >>> 14) >>> 0) / 4294967296;
            }
        }
        
        // Clear generation
        function clearGeneration() {
            document.getElementById('generated-results').innerHTML = '';
            document.getElementById('gen-details').innerHTML = '';
            document.getElementById('seed').value = '';
        }
        
        // Reverse engineer seed
        function reverseEngineerSeed() {
            const gameType = document.getElementById('reverse-game-type').value;
            let mainPool, pickCount, bonusPool, bonusCount;
            
            if (gameType === 'custom-reverse') {
                mainPool = parseInt(document.getElementById('reverse-main-numbers').value) || 69;
                pickCount = parseInt(document.getElementById('reverse-pick-numbers').value) || 5;
                bonusPool = parseInt(document.getElementById('reverse-bonus-numbers').value) || 0;
                bonusCount = parseInt(document.getElementById('reverse-pick-bonus').value) || 0;
            } else {
                // Set parameters based on game type
                switch (gameType) {
                    case 'powerball':
                        mainPool = 69;
                        pickCount = 5;
                        bonusPool = 26;
                        bonusCount = 1;
                        break;
                    case 'megamillions':
                        mainPool = 70;
                        pickCount = 5;
                        bonusPool = 25;
                        bonusCount = 1;
                        break;
                    case 'euromillions':
                        mainPool = 50;
                        pickCount = 5;
                        bonusPool = 12;
                        bonusCount = 2;
                        break;
                    default:
                        mainPool = 69;
                        pickCount = 5;
                        bonusPool = 26;
                        bonusCount = 1;
                }
            }
            
            const observedText = document.getElementById('observed-numbers').value.trim();
            if (!observedText) {
                document.getElementById('reverse-status').innerHTML = 
                    '<div class="status error">Please enter observed numbers to analyze.</div>';
                return;
            }
            
            // Parse observed numbers
            const observedDraws = [];
            const lines = observedText.split('\n');
            
            for (const line of lines) {
                const parts = line.split('|').map(p => p.trim());
                if (parts.length === 0) continue;
                
                // Parse main numbers
                const mainNumbers = parts[0].split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n));
                if (mainNumbers.length !== pickCount) {
                    document.getElementById('reverse-status').innerHTML = 
                        `<div class="status error">Invalid main numbers count in draw: ${mainNumbers.join(', ')}. Expected ${pickCount} numbers.</div>`;
                    return;
                }
                
                // Parse bonus numbers if available
                let bonusNumbers = [];
                if (parts.length > 1 && bonusCount > 0) {
                    bonusNumbers = parts[1].split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n));
                    if (bonusNumbers.length !== bonusCount) {
                        document.getElementById('reverse-status').innerHTML = 
                            `<div class="status error">Invalid bonus numbers count in draw: ${bonusNumbers.join(', ')}. Expected ${bonusCount} numbers.</div>`;
                        return;
                    }
                }
                
                observedDraws.push({
                    mainNumbers: mainNumbers,
                    bonusNumbers: bonusNumbers
                });
            }
            
            if (observedDraws.length === 0) {
                document.getElementById('reverse-status').innerHTML = 
                    '<div class="status error">No valid draws found in input.</div>';
                return;
            }
            
            // Prepare for reverse engineering
            document.getElementById('reverse-status').innerHTML = 
                `<div class="status info">Starting reverse engineering for ${observedDraws.length} draws...</div>`;
            document.getElementById('reverse-progress').style.display = 'block';
            document.getElementById('progress-bar').style.width = '0%';
            document.getElementById('stop-button').style.display = 'inline-block';
            stopReverseFlag = false;
            
            // Use Web Worker for reverse engineering to avoid UI freeze
            if (window.Worker) {
                if (reverseWorker) {
                    reverseWorker.terminate();
                }
                
                reverseWorker = new Worker(URL.createObjectURL(new Blob([
                    `onmessage = function(e) {
                        const { startSeed, endSeed, observedDraws, mainPool, pickCount, bonusPool, bonusCount } = e.data;
                        const foundSeeds = [];
                        
                        for (let seed = startSeed; seed <= endSeed; seed++) {
                            if (self.stopSignal) break;
                            
                            let match = true;
                            let verification = [];
                            
                            for (let i = 0; i < observedDraws.length && match; i++) {
                                const currentSeed = seed + i;
                                const draw = generateDrawInWorker(currentSeed, mainPool, pickCount, bonusPool, bonusCount);
                                verification.push(draw);
                                
                                // Check main numbers (order doesn't matter)
                                const observedMain = observedDraws[i].mainNumbers.slice().sort((a, b) => a - b);
                                const generatedMain = draw.mainNumbers.slice().sort((a, b) => a - b);
                                
                                for (let j = 0; j < observedMain.length; j++) {
                                    if (observedMain[j] !== generatedMain[j]) {
                                        match = false;
                                        break;
                                    }
                                }
                                
                                // Check bonus numbers if they exist
                                if (match && observedDraws[i].bonusNumbers && observedDraws[i].bonusNumbers.length > 0) {
                                    const observedBonus = observedDraws[i].bonusNumbers.slice().sort((a, b) => a - b);
                                    const generatedBonus = draw.bonusNumbers.slice().sort((a, b) => a - b);
                                    
                                    for (let j = 0; j < observedBonus.length; j++) {
                                        if (observedBonus[j] !== generatedBonus[j]) {
                                            match = false;
                                            break;
                                        }
                                    }
                                }
                            }
                            
                            if (match) {
                                foundSeeds.push({
                                    seed: seed,
                                    verification: verification
                                });
                            }
                            
                            // Report progress every 10000 seeds
                            if (seed % 10000 === 0) {
                                const progress = ((seed - startSeed) / (endSeed - startSeed)) * 100;
                                postMessage({
                                    type: 'progress',
                                    progress: progress,
                                    currentSeed: seed
                                });
                            }
                        }
                        
                        postMessage({
                            type: 'result',
                            foundSeeds: foundSeeds
                        });
                    }
                    
                    function generateDrawInWorker(seed, mainPool, pickCount, bonusPool, bonusCount) {
                        // Simplified draw generation for worker
                        const prng = new SeededPRNGWorker(seed);
                        
                        // Generate main numbers
                        const mainNumbers = [];
                        const pool = Array.from({length: mainPool}, (_, i) => i + 1);
                        
                        for (let i = pool.length - 1; i >= pool.length - pickCount; i--) {
                            const j = Math.floor(prng.next() * (i + 1));
                            [pool[i], pool[j]] = [pool[j], pool[i]];
                            mainNumbers.push(pool[i]);
                        }
                        
                        // Generate bonus numbers
                        const bonusNumbers = [];
                        if (bonusPool > 0 && bonusCount > 0) {
                            const bonusPrng = new SeededPRNGWorker(seed + 12345);
                            const bonusPoolArr = Array.from({length: bonusPool}, (_, i) => i + 1);
                            
                            for (let i = bonusPoolArr.length - 1; i >= bonusPoolArr.length - bonusCount; i--) {
                                const j = Math.floor(bonusPrng.next() * (i + 1));
                                [bonusPoolArr[i], bonusPoolArr[j]] = [bonusPoolArr[j], bonusPoolArr[i]];
                                bonusNumbers.push(bonusPoolArr[i]);
                            }
                        }
                        
                        return {
                            mainNumbers: mainNumbers,
                            bonusNumbers: bonusNumbers
                        };
                    }
                    
                    function SeededPRNGWorker(seed) {
                        this.seed = seed;
                        this.next = function() {
                            this.seed |= 0;
                            this.seed = this.seed + 0x6D2B79F5 | 0;
                            let t = Math.imul(this.seed ^ this.seed >>> 15, 1 | this.seed);
                            t = t + Math.imul(t ^ t >>> 7, 61 | t) ^ t;
                            return ((t ^ t >>> 14) >>> 0) / 4294967296;
                        }
                    }`
                ], {type: 'application/javascript'})));
                
                reverseWorker.onmessage = function(e) {
                    if (e.data.type === 'progress') {
                        document.getElementById('progress-bar').style.width = e.data.progress + '%';
                        document.getElementById('reverse-status').innerHTML = 
                            `<div class="status info">Searching... ${e.data.progress.toFixed(1)}% complete (seed: ${e.data.currentSeed})</div>`;
                    } else if (e.data.type === 'result') {
                        reverseWorker.terminate();
                        reverseWorker = null;
                        
                        document.getElementById('stop-button').style.display = 'none';
                        
                        if (stopReverseFlag) {
                            document.getElementById('reverse-status').innerHTML = 
                                '<div class="status warning">Reverse engineering stopped by user.</div>';
                            return;
                        }
                        
                        if (e.data.foundSeeds.length > 0) {
                            let resultsHtml = '<h3>Found Matching Seeds</h3>';
                            let verificationHtml = '';
                            
                            e.data.foundSeeds.forEach((found, idx) => {
                                resultsHtml += `
                                    <div class="status success">
                                        <p><strong>Seed ${idx+1}:</strong> ${found.seed}</p>
                                    </div>
                                `;
                                
                                verificationHtml += `<h4>Verification for seed ${found.seed}</h4>`;
                                
                                found.verification.forEach((draw, drawIdx) => {
                                    verificationHtml += `<div class="lotto-draw">
                                        <div class="lotto-balls">`;
                                    
                                    draw.mainNumbers.sort((a, b) => a - b).forEach(num => {
                                        verificationHtml += `<div class="ball">${num}</div>`;
                                    });
                                    
                                    if (draw.bonusNumbers.length > 0) {
                                        verificationHtml += `<div class="ball powerball">${draw.bonusNumbers.sort((a, b) => a - b).join(', ')}</div>`;
                                    }
                                    
                                    verificationHtml += `</div>
                                        <div><small>Draw ${drawIdx+1} | Expected: ${lines[drawIdx]}</small></div>
                                    </div>`;
                                });
                            });
                            
                            document.getElementById('reverse-results').innerHTML = resultsHtml;
                            document.getElementById('verification-results').innerHTML = verificationHtml;
                            
                            document.getElementById('reverse-status').innerHTML = 
                                `<div class="status success">Found ${e.data.foundSeeds.length} matching seed(s)!</div>`;
                        } else {
                            document.getElementById('reverse-results').innerHTML = 
                                '<div class="status error">No matching seeds found in the searched range.</div>';
                            document.getElementById('reverse-status').innerHTML = 
                                '<div class="status warning">No matching seeds found. Try with more observed draws or a different range.</div>';
                        }
                    }
                };
                
                // Start with a reasonable range (adjust as needed)
                const startSeed = 0;
                const endSeed = 1000000; // 1 million seeds to check
                
                reverseWorker.postMessage({
                    startSeed: startSeed,
                    endSeed: endSeed,
                    observedDraws: observedDraws,
                    mainPool: mainPool,
                    pickCount: pickCount,
                    bonusPool: bonusPool,
                    bonusCount: bonusCount
                });
            } else {
                document.getElementById('reverse-status').innerHTML = 
                    '<div class="status error">Web Workers not supported in your browser. Reverse engineering requires a modern browser.</div>';
            }
        }
        
        function stopReverseEngineer() {
            stopReverseFlag = true;
            if (reverseWorker) {
                reverseWorker.terminate();
                reverseWorker = null;
            }
            document.getElementById('reverse-status').innerHTML = 
                '<div class="status warning">Reverse engineering stopped by user.</div>';
            document.getElementById('stop-button').style.display = 'none';
        }
        
        function clearReverse() {
            document.getElementById('observed-numbers').value = '';
            document.getElementById('reverse-results').innerHTML = 'Results will appear here after analysis.';
            document.getElementById('verification-results').innerHTML = '';
            document.getElementById('reverse-status').innerHTML = 
                'Enter observed numbers to begin reverse engineering.';
            document.getElementById('reverse-progress').style.display = 'none';
            document.getElementById('stop-button').style.display = 'none';
        }
        
        // Compare draws
        function compareDraws() {
            const seed = parseInt(document.getElementById('compare-seed').value);
            if (isNaN(seed)) {
                document.getElementById('compare-results').innerHTML = 
                    '<div class="status error">Please enter a valid seed to compare.</div>';
                return;
            }
            
            const drawCount = parseInt(document.getElementById('compare-draws').value) || 10;
            const observedText = document.getElementById('compare-observed').value.trim();
            
            if (!observedText) {
                document.getElementById('compare-results').innerHTML = 
                    '<div class="status error">Please enter observed numbers to compare.</div>';
                return;
            }
            
            // Parse observed numbers (simplified parsing for comparison)
            const observedDraws = [];
            const lines = observedText.split('\n');
            
            for (const line of lines) {
                const parts = line.split('|').map(p => p.trim());
                if (parts.length === 0) continue;
                
                // Parse all numbers (we don't distinguish main/bonus for comparison)
                const numbers = [];
                parts.forEach(part => {
                    numbers.push(...part.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n)));
                });
                
                if (numbers.length > 0) {
                    observedDraws.push(numbers.sort((a, b) => a - b));
                }
            }
            
            if (observedDraws.length === 0) {
                document.getElementById('compare-results').innerHTML = 
                    '<div class="status error">No valid draws found in input.</div>';
                return;
            }
            
            // Generate draws from seed
            const generatedDraws = [];
            for (let i = 0; i < Math.max(drawCount, observedDraws.length); i++) {
                const draw = generateDraw(seed + i, 69, 5, 26, 1); // Using Powerball params for comparison
                const allNumbers = [...draw.mainNumbers, ...draw.bonusNumbers].sort((a, b) => a - b);
                generatedDraws.push(allNumbers);
            }
            
            // Compare draws
            let comparisonHtml = '';
            let matches = 0;
            let totalNumbers = 0;
            
            comparisonHtml += `<table style="width: 100%; border-collapse: collapse;">
                <tr>
                    <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ddd;">Draw</th>
                    <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ddd;">Observed</th>
                    <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ddd;">Generated</th>
                    <th style="text-align: left; padding: 8px; border-bottom: 1px solid #ddd;">Matches</th>
                </tr>`;
            
            for (let i = 0; i < observedDraws.length && i < generatedDraws.length; i++) {
                const observed = observedDraws[i];
                const generated = generatedDraws[i];
                
                // Find matching numbers
                const matchedNumbers = [];
                let drawMatches = 0;
                
                for (const num of observed) {
                    if (generated.includes(num)) {
                        matchedNumbers.push(num);
                        drawMatches++;
                    }
                }
                
                matches += drawMatches;
                totalNumbers += observed.length;
                
                comparisonHtml += `<tr>
                    <td style="padding: 8px; border-bottom: 1px solid #ddd;">${i+1}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #ddd;">${observed.join(', ')}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #ddd;">${generated.join(', ')}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #ddd;">
                        ${drawMatches > 0 ? `<span style="color: var(--success);">${drawMatches} matches (${matchedNumbers.join(', ')})</span>` : 'No matches'}
                    </td>
                </tr>`;
            }
            
            comparisonHtml += `</table>`;
            
            document.getElementById('compare-results').innerHTML = comparisonHtml;
            
            // Calculate statistics
            const matchPercentage = totalNumbers > 0 ? (matches / totalNumbers * 100).toFixed(2) : 0;
            const statsHtml = `
                <p>Total numbers compared: ${totalNumbers}</p>
                <p>Matching numbers found: ${matches} (${matchPercentage}%)</p>
                <p>Average matches per draw: ${(matches / Math.min(observedDraws.length, generatedDraws.length)).toFixed(2)}</p>
            `;
            
            document.getElementById('compare-stats').innerHTML = statsHtml;
        }
    </script>
    <!-- Add this script right before the closing </body> tag, after your existing JavaScript -->
<script>
// ====== ENHANCED SEED PATTERN DETECTOR & PREDICTOR ======
class LotterySeedAnalyzer {
    constructor() {
        this.history = [];
        this.detectedPatterns = [];
    }
    
    // Main analysis function (call this with your historical draws)
    analyzeHistoricalDraws(draws) {
        this.history = draws;
        this.detectedPatterns = this.detectAdvancedPatterns();
        return {
            patterns: this.detectedPatterns,
            predictedSeed: this.predictNextSeed(),
            predictedNumbers: this.generatePredictedNumbers()
        };
    }
    
    detectAdvancedPatterns() {
        const patterns = [];
        if (this.history.length < 2) return patterns;
        
        // 1. Check for consistent differences between numbers
        const diffPattern = this.checkConsistentDifferences();
        if (diffPattern) patterns.push(diffPattern);
        
        // 2. Check for LCG (PRNG) patterns
        const lcgPattern = this.detectLCGPattern();
        if (lcgPattern) patterns.push(lcgPattern);
        
        // 3. Check for modulo patterns
        const modPattern = this.checkModuloPatterns();
        if (modPattern) patterns.push(modPattern);
        
        // 4. Check for arithmetic sequences
        const seqPattern = this.checkArithmeticSequences();
        if (seqPattern) patterns.push(seqPattern);
        
        return patterns.length > 0 ? patterns : 
            [{ type: 'random', confidence: 'low', message: 'No strong patterns detected' }];
    }
    
    checkConsistentDifferences() {
        const diffs = [];
        const firstDraw = this.history[0];
        
        for (let i = 1; i < firstDraw.length; i++) {
            diffs.push(firstDraw[i] - firstDraw[i-1]);
        }
        
        let isConsistent = true;
        for (const draw of this.history) {
            for (let i = 1; i < draw.length; i++) {
                if (draw[i] - draw[i-1] !== diffs[i-1]) {
                    isConsistent = false;
                    break;
                }
            }
            if (!isConsistent) break;
        }
        
        return isConsistent ? {
            type: 'consistent_differences',
            values: diffs,
            confidence: 'high',
            message: `Consistent differences between numbers: ${diffs.join(', ')}`
        } : null;
    }
    
    detectLCGPattern() {
        if (this.history.length < 3) return null;
        
        const m = Math.pow(2, 32);
        const x0 = this.history[0][0];
        const x1 = this.history[1][0];
        const x2 = this.history[2][0];
        
        for (let a = 1; a < 1000; a++) {
            const c = (x1 - (a * x0)) % m;
            if ((a * x1 + c) % m === x2) {
                return {
                    type: 'lcg_pattern',
                    parameters: { a, c, m },
                    confidence: this.history.length > 5 ? 'high' : 'medium',
                    message: `Possible LCG generator with multiplier=${a}, increment=${c}`
                };
            }
        }
        return null;
    }
    
    checkModuloPatterns() {
        const modTests = [2, 3, 5, 7, 10];
        const results = [];
        
        for (const mod of modTests) {
            const remainders = new Set();
            this.history.forEach(draw => {
                draw.forEach(num => remainders.add(num % mod));
            });
            
            if (remainders.size === 1) {
                results.push({
                    modulo: mod,
                    remainder: Array.from(remainders)[0]
                });
            }
        }
        
        return results.length > 0 ? {
            type: 'modulo_pattern',
            values: results,
            confidence: 'medium',
            message: `Numbers follow modulo patterns: ${results.map(r => `x ≡ ${r.remainder} mod ${r.modulo}`).join(', ')}`
        } : null;
    }
    
    checkArithmeticSequences() {
        const sequences = [];
        
        this.history.forEach(draw => {
            const sorted = [...draw].sort((a, b) => a - b);
            const diffs = [];
            for (let i = 1; i < sorted.length; i++) {
                diffs.push(sorted[i] - sorted[i-1]);
            }
            
            if (new Set(diffs).size === 1) {
                sequences.push({
                    draw: draw,
                    difference: diffs[0]
                });
            }
        });
        
        return sequences.length > 0 ? {
            type: 'arithmetic_sequence',
            values: sequences,
            confidence: sequences.length > 1 ? 'high' : 'medium',
            message: `${sequences.length} draws form arithmetic sequences`
        } : null;
    }
    
    predictNextSeed() {
        if (this.detectedPatterns.some(p => p.type === 'lcg_pattern')) {
            const lcg = this.detectedPatterns.find(p => p.type === 'lcg_pattern');
            const lastNum = this.history[this.history.length - 1][0];
            return (lcg.parameters.a * lastNum + lcg.parameters.c) % lcg.parameters.m;
        }
        
        // Fallback prediction methods
        const lastDraw = this.history[this.history.length - 1];
        const avg = lastDraw.reduce((sum, num) => sum + num, 0) / lastDraw.length;
        
        // Weighted prediction (more weight to recent numbers)
        let weightedSum = 0;
        let weightTotal = 0;
        this.history.forEach((draw, i) => {
            const weight = i + 1;
            draw.forEach(num => {
                weightedSum += num * weight;
                weightTotal += weight;
            });
        });
        const weightedAvg = weightedSum / weightTotal;
        
        return Math.round((avg + weightedAvg) / 2);
    }
    
    generatePredictedNumbers() {
        const seed = this.predictNextSeed();
        const numCount = this.history[0].length;
        const numbers = [];
        
        // Generate numbers based on seed and detected patterns
        if (this.detectedPatterns.some(p => p.type === 'lcg_pattern')) {
            const lcg = this.detectedPatterns.find(p => p.type === 'lcg_pattern');
            let current = seed;
            for (let i = 0; i < numCount * 2; i++) {
                current = (lcg.parameters.a * current + lcg.parameters.c) % lcg.parameters.m;
                const num = current % 100;
                if (!numbers.includes(num)) numbers.push(num);
                if (numbers.length >= numCount) break;
            }
        } else if (this.detectedPatterns.some(p => p.type === 'consistent_differences')) {
            const diffPattern = this.detectedPatterns.find(p => p.type === 'consistent_differences');
            let lastNum = this.history[this.history.length - 1][this.history[0].length - 1];
            numbers.push(lastNum);
            
            for (let i = 0; i < diffPattern.values.length && numbers.length < numCount; i++) {
                lastNum += diffPattern.values[i];
                numbers.push(lastNum);
            }
        } else {
            // Fallback: simple seeded generation
            const prng = new SeededPRNG(seed);
            for (let i = 0; i < numCount * 2; i++) {
                const num = Math.floor(prng.next() * 100);
                if (!numbers.includes(num)) numbers.push(num);
                if (numbers.length >= numCount) break;
            }
        }
        
        return numbers.slice(0, numCount).sort((a, b) => a - b);
    }
}

// ====== INTEGRATION WITH YOUR EXISTING UI ======
// Add this function to connect the analyzer to your reverse engineering tab
function analyzeWithSeedDetector() {
    const observedText = document.getElementById('observed-numbers').value.trim();
    if (!observedText) {
        document.getElementById('reverse-status').innerHTML = 
            '<div class="status error">Please enter observed numbers first.</div>';
        return;
    }
    
    // Parse observed numbers
    const draws = [];
    const lines = observedText.split('\n');
    for (const line of lines) {
        const numbers = line.split(/[\s,|]+/).filter(x => x.trim() !== '').map(Number);
        if (numbers.length > 0) draws.push(numbers);
    }
    
    if (draws.length < 2) {
        document.getElementById('reverse-status').innerHTML = 
            '<div class="status error">Need at least 2 draws for pattern detection.</div>';
        return;
    }
    
    document.getElementById('reverse-status').innerHTML = 
        '<div class="status info">Analyzing seed patterns...</div>';
    
    setTimeout(() => {
        const analyzer = new LotterySeedAnalyzer();
        const results = analyzer.analyzeHistoricalDraws(draws);
        
        // Display results
        let patternsHtml = '<h3>Detected Seed Patterns</h3>';
        results.patterns.forEach(pattern => {
            patternsHtml += `
                <div class="status ${pattern.confidence === 'high' ? 'success' : 'warning'}">
                    <strong>${pattern.type.replace(/_/g, ' ')}:</strong> ${pattern.message}
                </div>
            `;
        });
        
        let predictionHtml = `
            <h3>Seed Prediction</h3>
            <div class="status info">
                Predicted next seed: <strong>${results.predictedSeed}</strong>
            </div>
            <h3>Predicted Numbers</h3>
            <div class="lotto-balls">
        `;
        
        results.predictedNumbers.forEach(num => {
            predictionHtml += `<div class="ball">${num}</div>`;
        });
        
        predictionHtml += `</div>`;
        
        document.getElementById('reverse-results').innerHTML = patternsHtml + predictionHtml;
        document.getElementById('reverse-status').innerHTML = 
            '<div class="status success">Pattern analysis completed!</div>';
        
    }, 100);
}

// Add this button next to your "Reverse Engineer Seed" button in the HTML
// <button onclick="analyzeWithSeedDetector()" class="success">Analyze Seed Patterns</button>

// ====== ENHANCED SEED PREDICTION IN GENERATOR ======
// Modify your generateLottoNumbers() function to use pattern detection when seed is empty
const originalGenerateLottoNumbers = generateLottoNumbers;
generateLottoNumbers = function() {
    const seedInput = document.getElementById('seed').value.trim();
    
    if (!seedInput && document.getElementById('observed-numbers').value.trim()) {
        // If no seed provided but we have observed numbers, try to predict
        const observedText = document.getElementById('observed-numbers').value.trim();
        const draws = observedText.split('\n')
            .map(line => line.split(/[\s,|]+/).filter(x => x.trim() !== '').map(Number))
            .filter(arr => arr.length > 0);
        
        if (draws.length >= 2) {
            const analyzer = new LotterySeedAnalyzer();
            const results = analyzer.analyzeHistoricalDraws(draws);
            document.getElementById('seed').value = results.predictedSeed;
            
            document.getElementById('gen-details').innerHTML = `
                <div class="status success">
                    <strong>Auto-generated seed</strong> using detected patterns
                </div>
                ${document.getElementById('gen-details').innerHTML}
            `;
        }
    }
    
    originalGenerateLottoNumbers();
};
</script>
</body>
</html>
